<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Signum ‚Äî Website Trust Intelligence</title>
  <meta name="description" content="Instantly check if any website is safe. 20 intelligence sources, AI-powered risk analysis." />
  <meta property="og:title" content="Signum ‚Äî Website Trust Intelligence" />
  <meta property="og:description" content="Check any website for scams, fraud and safety risks. Free, instant, AI-powered." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://signumaiapp.com" />
  <meta property="og:image" content="https://signumaiapp.com/og-image.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Signum ‚Äî Website Trust Intelligence" />
  <meta name="twitter:description" content="Check any website for scams, fraud and safety risks. Free, instant, AI-powered." />
  <link rel="canonical" href="https://signumaiapp.com" />
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='8' fill='%233b82f6'/><polyline points='6,22 12,14 18,18 26,8' fill='none' stroke='white' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'/></svg>" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg:       #0b0f1a;
      --bg2:      #111827;
      --surface:  #131c2e;
      --surface2: #1a2540;
      --border:   #1e2d4a;
      --border2:  #243358;
      --text:     #e8edf5;
      --text-muted: #7a8aaa;
      --text-faint: #3d4f6e;
      --blue:     #3b82f6;
      --blue-soft:#1d3461;
      --blue-glow:rgba(59,130,246,0.15);
      --green:    #22c55e;
      --green-bg: rgba(34,197,94,0.08);
      --green-border: rgba(34,197,94,0.25);
      --yellow:   #eab308;
      --yellow-bg: rgba(234,179,8,0.08);
      --yellow-border: rgba(234,179,8,0.25);
      --red:      #ef4444;
      --red-bg:   rgba(239,68,68,0.08);
      --red-border: rgba(239,68,68,0.25);
      --r: 10px;
    }
    body { background: var(--bg); font-family: 'DM Sans', sans-serif; color: var(--text); min-height: 100vh; font-size: 15px; line-height: 1.6; -webkit-font-smoothing: antialiased; }
    .page { max-width: 680px; margin: 0 auto; padding: 0 20px 100px; }

    /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
    nav { display: flex; align-items: center; justify-content: space-between; padding: 18px 0 16px; border-bottom: 1px solid var(--border); margin-bottom: 52px; }
    .logo { display: flex; align-items: center; gap: 9px; font-size: 17px; font-weight: 600; letter-spacing: -0.4px; color: var(--text); text-decoration: none; }
    .logo-icon { width: 28px; height: 28px; background: var(--blue); border-radius: 7px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 0 16px rgba(59,130,246,0.4); }
    .logo-icon svg { width: 15px; height: 15px; stroke: #fff; fill: none; stroke-width: 2.2; stroke-linecap: round; stroke-linejoin: round; }
    .nav-right { display: flex; align-items: center; gap: 8px; }

    .btn-sm { padding: 7px 16px; border-radius: 7px; font-size: 13px; font-weight: 500; font-family: 'DM Sans', sans-serif; cursor: pointer; transition: all 0.15s; border: none; }
    .btn-outline { background: none; border: 1px solid var(--border2) !important; color: var(--text-muted); }
    .btn-outline:hover { border-color: var(--blue) !important; color: var(--blue); }
    .btn-blue { background: var(--blue); color: #fff; box-shadow: 0 0 20px rgba(59,130,246,0.3); }
    .btn-blue:hover { opacity: 0.88; }
    .nav-email { font-size: 12px; color: var(--text-muted); font-family: 'DM Mono', monospace; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    .hero { margin-bottom: 40px; text-align: center; padding: 0 10px; }
    .hero-badge { display: inline-flex; align-items: center; gap: 8px; background: var(--surface); border: 1px solid var(--border2); border-radius: 100px; padding: 5px 14px; font-size: 12px; color: var(--text-muted); margin-bottom: 24px; font-family: 'DM Mono', monospace; }
    .badge-dot { width: 6px; height: 6px; background: var(--green); border-radius: 50%; animation: blink 2.5s ease-in-out infinite; flex-shrink: 0; box-shadow: 0 0 6px var(--green); }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }
    .hero-title { font-size: clamp(28px, 5vw, 42px); font-weight: 600; letter-spacing: -1.2px; line-height: 1.12; color: var(--text); margin-bottom: 14px; }
    .hero-title em { color: var(--blue); font-style: normal; }
    .hero-sub { font-size: 15px; color: var(--text-muted); max-width: 460px; margin: 0 auto; line-height: 1.65; }

    /* ‚îÄ‚îÄ BANNERS ‚îÄ‚îÄ */
    .plan-banner { display: none; align-items: center; justify-content: space-between; gap: 12px; border-radius: var(--r); padding: 11px 16px; margin-bottom: 16px; font-size: 13px; flex-wrap: wrap; }
    .plan-banner.free { background: var(--yellow-bg); border: 1px solid var(--yellow-border); }
    .plan-banner.pro  { background: var(--green-bg); border: 1px solid var(--green-border); }
    .banner-label { font-weight: 600; color: var(--text); font-size: 13px; }
    .banner-sub { font-size: 12px; color: var(--text-muted); }
    .btn-upgrade { background: var(--blue); color: #fff; border: none; padding: 7px 16px; border-radius: 7px; font-size: 13px; font-weight: 500; cursor: pointer; font-family: 'DM Sans', sans-serif; white-space: nowrap; transition: opacity 0.15s; }
    .btn-upgrade:hover { opacity: 0.85; }

    /* ‚îÄ‚îÄ SEARCH ‚îÄ‚îÄ */
    .search-wrap { margin-bottom: 40px; }
    .search-box { display: flex; gap: 8px; background: var(--surface); border: 1.5px solid var(--border2); border-radius: var(--r); padding: 7px 7px 7px 18px; box-shadow: 0 4px 24px rgba(0,0,0,0.3), 0 0 0 1px rgba(59,130,246,0); transition: all 0.2s; }
    .search-box:focus-within { border-color: var(--blue); box-shadow: 0 4px 24px rgba(0,0,0,0.3), 0 0 0 3px var(--blue-glow); }
    .search-input { flex: 1; background: none; border: none; outline: none; font-size: 15px; font-family: 'DM Sans', sans-serif; color: var(--text); min-width: 0; }
    .search-input::placeholder { color: var(--text-faint); }
    .search-btn { background: var(--blue); color: #fff; border: none; padding: 10px 24px; border-radius: 7px; font-size: 14px; font-weight: 500; font-family: 'DM Sans', sans-serif; cursor: pointer; white-space: nowrap; transition: opacity 0.15s; flex-shrink: 0; box-shadow: 0 0 20px rgba(59,130,246,0.35); }
    .search-btn:hover { opacity: 0.85; }
    .search-btn:disabled { opacity: 0.35; cursor: not-allowed; box-shadow: none; }
    .search-hint { margin-top: 9px; text-align: center; font-size: 12px; color: var(--text-faint); font-family: 'DM Mono', monospace; }

    /* ‚îÄ‚îÄ HOW IT WORKS ‚îÄ‚îÄ */
    .how-wrap { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 44px; }
    @media(max-width:520px){ .how-wrap { grid-template-columns: 1fr; } }
    .how-step { background: var(--surface); border: 1px solid var(--border); border-radius: var(--r); padding: 18px; }
    .how-num { font-family: 'DM Mono', monospace; font-size: 11px; color: var(--blue); margin-bottom: 8px; font-weight: 500; }
    .how-title { font-size: 14px; font-weight: 600; margin-bottom: 4px; color: var(--text); }
    .how-sub { font-size: 12px; color: var(--text-muted); line-height: 1.5; }

    /* ‚îÄ‚îÄ STATUS ‚îÄ‚îÄ */
    .status-wrap { background: var(--surface); border: 1px solid var(--border); border-radius: var(--r); padding: 16px 20px; margin-bottom: 16px; display: none; }
    .status-wrap.visible { display: block; }
    .status-inner { display: flex; align-items: center; gap: 12px; }
    .spinner { width: 15px; height: 15px; border: 2px solid var(--border2); border-top-color: var(--blue); border-radius: 50%; animation: spin 0.7s linear infinite; flex-shrink: 0; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .status-text { font-size: 13px; color: var(--text-muted); font-family: 'DM Mono', monospace; }

    /* ‚îÄ‚îÄ MESSAGES ‚îÄ‚îÄ */
    .msg { border-radius: var(--r); padding: 12px 16px; font-size: 13px; font-weight: 500; margin-bottom: 16px; display: none; }
    .msg.visible { display: block; }
    .msg.error   { background: var(--red-bg); border: 1px solid var(--red-border); color: var(--red); }
    .msg.success { background: var(--green-bg); border: 1px solid var(--green-border); color: var(--green); }

    /* ‚îÄ‚îÄ REPORT ‚îÄ‚îÄ */
    .report { display: none; }
    .report.visible { display: block; animation: fadeUp 0.3s ease; }
    @keyframes fadeUp { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:none} }

    /* Verdict card */
    .verdict-card { border-radius: var(--r); padding: 24px; margin-bottom: 10px; }
    .verdict-card.GREEN { background: var(--green-bg); border: 1px solid var(--green-border); }
    .verdict-card.YELLOW { background: var(--yellow-bg); border: 1px solid var(--yellow-border); }
    .verdict-card.RED { background: var(--red-bg); border: 1px solid var(--red-border); }
    .verdict-top { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
    .score-ring { position: relative; width: 80px; height: 80px; flex-shrink: 0; }
    .score-ring svg { width: 80px; height: 80px; transform: rotate(-90deg); }
    .score-ring-bg { fill: none; stroke-width: 6; stroke: rgba(255,255,255,0.06); }
    .score-ring-fill { fill: none; stroke-width: 6; stroke-linecap: round; transition: stroke-dashoffset 1s ease; }
    .verdict-card.GREEN .score-ring-fill { stroke: var(--green); }
    .verdict-card.YELLOW .score-ring-fill { stroke: var(--yellow); }
    .verdict-card.RED .score-ring-fill { stroke: var(--red); }
    .score-center { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .score-num { font-size: 22px; font-weight: 700; letter-spacing: -1px; line-height: 1; }
    .verdict-card.GREEN .score-num { color: var(--green); }
    .verdict-card.YELLOW .score-num { color: var(--yellow); }
    .verdict-card.RED .score-num { color: var(--red); }
    .score-lbl { font-size: 9px; font-family: 'DM Mono', monospace; color: var(--text-faint); margin-top: 2px; }
    .verdict-meta { flex: 1; min-width: 160px; }
    .verdict-label { font-size: 22px; font-weight: 700; letter-spacing: -0.5px; margin-bottom: 4px; }
    .verdict-card.GREEN .verdict-label { color: var(--green); }
    .verdict-card.YELLOW .verdict-label { color: var(--yellow); }
    .verdict-card.RED .verdict-label { color: var(--red); }
    .verdict-summary { font-size: 14px; color: var(--text-muted); line-height: 1.55; }

    /* Dashboard signals */
    .dashboard { background: rgba(0,0,0,0.2); border-radius: 8px; padding: 16px; border: 1px solid rgba(255,255,255,0.05); }
    .dashboard-row { display: flex; align-items: center; gap: 8px; padding: 5px 0; font-size: 13px; color: var(--text-muted); border-bottom: 1px solid rgba(255,255,255,0.04); }
    .dashboard-row:last-child { border-bottom: none; }
    .dash-icon { font-size: 13px; flex-shrink: 0; width: 20px; }
    .confidence-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
    .confidence-label { font-size: 12px; font-family: 'DM Mono', monospace; color: var(--text-faint); }
    .confidence-badge { font-size: 11px; font-family: 'DM Mono', monospace; font-weight: 500; padding: 2px 8px; border-radius: 100px; }
    .conf-high { background: rgba(34,197,94,0.15); color: var(--green); }
    .conf-med  { background: rgba(234,179,8,0.15); color: var(--yellow); }
    .conf-low  { background: rgba(239,68,68,0.15); color: var(--red); }

    /* Share btn */
    .share-btn { display: inline-flex; align-items: center; gap: 6px; margin-top: 14px; background: none; border: 1px solid var(--border2); border-radius: 7px; padding: 7px 14px; font-size: 12px; font-family: 'DM Sans', sans-serif; color: var(--text-muted); cursor: pointer; transition: all 0.15s; font-weight: 500; }
    .share-btn:hover { border-color: var(--blue); color: var(--blue); }
    .share-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); z-index: 300; display: none; align-items: flex-end; justify-content: center; padding: 20px; }
    .share-modal.open { display: flex; }
    @media(min-width:520px){ .share-modal { align-items: center; } }
    .share-sheet { background: var(--surface2); border: 1px solid var(--border2); border-radius: 16px; padding: 24px; width: 100%; max-width: 400px; animation: slideUp 0.25s ease; }
    @keyframes slideUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:none} }
    .share-sheet-title { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 4px; }
    .share-sheet-sub { font-size: 12px; color: var(--text-muted); margin-bottom: 20px; font-family: 'DM Mono', monospace; }
    .share-platforms { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 16px; }
    .share-platform { display: flex; flex-direction: column; align-items: center; gap: 7px; padding: 14px 8px; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; cursor: pointer; transition: all 0.15s; text-decoration: none; }
    .share-platform:hover { border-color: var(--blue); background: var(--blue-soft); }
    .share-platform-icon { font-size: 22px; line-height: 1; }
    .share-platform-name { font-size: 10px; color: var(--text-muted); font-weight: 500; text-align: center; }
    .share-copy-row { display: flex; gap: 8px; }
    .share-copy-input { flex: 1; background: var(--bg2); border: 1px solid var(--border); color: var(--text-muted); padding: 9px 12px; font-size: 12px; font-family: 'DM Mono', monospace; border-radius: 7px; outline: none; }
    .share-copy-btn { background: var(--blue); color: #fff; border: none; padding: 9px 16px; border-radius: 7px; font-size: 12px; font-weight: 500; font-family: 'DM Sans', sans-serif; cursor: pointer; white-space: nowrap; transition: opacity 0.15s; }
    .share-copy-btn:hover { opacity: 0.85; }
    .share-dismiss { width: 100%; background: none; border: 1px solid var(--border); color: var(--text-muted); padding: 10px; border-radius: 8px; font-size: 13px; font-family: 'DM Sans', sans-serif; cursor: pointer; margin-top: 10px; transition: all 0.15s; }
    .share-dismiss:hover { color: var(--text); }

    /* Sections */
    .section { background: var(--surface); border: 1px solid var(--border); border-radius: var(--r); padding: 20px; margin-bottom: 10px; }
    .section-header { font-size: 11px; font-family: 'DM Mono', monospace; font-weight: 500; color: var(--text-faint); letter-spacing: 0.8px; text-transform: uppercase; margin-bottom: 14px; }
    .finding { display: flex; gap: 12px; padding: 9px 0; border-bottom: 1px solid var(--border); }
    .finding:last-child { border-bottom: none; padding-bottom: 0; }
    .finding:first-child { padding-top: 0; }
    .f-icon { font-size: 15px; flex-shrink: 0; width: 22px; margin-top: 2px; }
    .f-body { flex: 1; }
    .f-tag { display: inline-block; font-size: 10px; font-family: 'DM Mono', monospace; font-weight: 500; padding: 2px 7px; border-radius: 4px; margin-bottom: 3px; }
    .f-tag.RISK    { background: var(--red-bg); color: var(--red); border: 1px solid var(--red-border); }
    .f-tag.CAUTION { background: var(--yellow-bg); color: var(--yellow); border: 1px solid var(--yellow-border); }
    .f-tag.OK      { background: var(--green-bg); color: var(--green); border: 1px solid var(--green-border); }
    .f-text { font-size: 13px; color: var(--text-muted); line-height: 1.5; }
    .narrative { font-size: 14px; color: var(--text-muted); line-height: 1.7; }
    .raw-btn { background: none; border: none; font-size: 12px; font-family: 'DM Mono', monospace; color: var(--text-faint); cursor: pointer; display: flex; align-items: center; gap: 6px; padding: 0; margin-bottom: 10px; }
    .raw-btn:hover { color: var(--text-muted); }
    .data-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 8px; max-height: 0; overflow: hidden; transition: max-height 0.35s; }
    .data-grid.open { max-height: 2000px; }

    /* ‚îÄ‚îÄ Feature Lock ‚îÄ‚îÄ */
    .locked-section { position: relative; }
    .locked-section .section { pointer-events: none; }
    .locked-section .section > * { filter: blur(4px); user-select: none; }
    .lock-overlay { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 12px; z-index: 10; background: rgba(11,15,26,0.7); border-radius: var(--r); backdrop-filter: blur(2px); padding: 24px; text-align: center; }
    .lock-icon { font-size: 28px; }
    .lock-title { font-size: 15px; font-weight: 600; color: var(--text); letter-spacing: -0.3px; }
    .lock-sub { font-size: 12px; color: var(--text-muted); line-height: 1.5; max-width: 260px; }
    .lock-btn { background: var(--blue); color: #fff; border: none; padding: 10px 24px; border-radius: 8px; font-size: 13px; font-weight: 600; font-family: 'DM Sans', sans-serif; cursor: pointer; transition: opacity 0.15s; box-shadow: 0 0 20px var(--blue-glow); margin-top: 4px; }
    .lock-btn:hover { opacity: 0.85; }
    .lock-features { display: flex; flex-direction: column; gap: 4px; margin-top: 4px; }
    .lock-feature { font-size: 11px; color: var(--text-muted); display: flex; align-items: center; gap: 6px; }
    .lock-feature::before { content: "‚úì"; color: var(--green); font-weight: 600; }
    .data-cell { background: var(--bg2); border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px; }
    .data-lbl { font-size: 10px; font-family: 'DM Mono', monospace; color: var(--text-faint); margin-bottom: 3px; }
    .data-val { font-size: 12px; color: var(--text-muted); }

    /* ‚îÄ‚îÄ TRUST STRIP ‚îÄ‚îÄ */
    .trust-strip { display: flex; align-items: center; justify-content: center; gap: 24px; flex-wrap: wrap; margin: 44px 0; padding: 20px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--r); }
    .trust-item { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-muted); font-weight: 500; }
    .trust-icon { font-size: 15px; }

    /* ‚îÄ‚îÄ PRICING ‚îÄ‚îÄ */
    .pricing { margin-top: 56px; padding-top: 48px; border-top: 1px solid var(--border); }
    .pricing-head { text-align: center; margin-bottom: 28px; }
    .pricing-title { font-size: 26px; font-weight: 600; letter-spacing: -0.6px; margin-bottom: 6px; }
    .pricing-sub { font-size: 14px; color: var(--text-muted); }
    .pricing-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    @media(max-width:520px){ .pricing-grid { grid-template-columns: 1fr; } }
    .pricing-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--r); padding: 24px; position: relative; }
    .pricing-card.pro { border-color: var(--blue); box-shadow: 0 0 24px var(--blue-glow); }
    .popular-badge { position: absolute; top: -11px; left: 50%; transform: translateX(-50%); background: var(--blue); color: #fff; font-size: 10px; font-weight: 600; font-family: 'DM Mono', monospace; padding: 3px 12px; border-radius: 100px; white-space: nowrap; letter-spacing: 0.5px; }
    .plan-name { font-size: 11px; font-family: 'DM Mono', monospace; font-weight: 500; color: var(--text-faint); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 10px; }
    .plan-price { font-size: 34px; font-weight: 700; letter-spacing: -1.5px; margin-bottom: 2px; }
    .plan-period { font-size: 12px; color: var(--text-muted); margin-bottom: 20px; }
    .plan-features { list-style: none; margin-bottom: 22px; }
    .plan-features li { font-size: 13px; color: var(--text-muted); padding: 7px 0; border-bottom: 1px solid var(--border); display: flex; align-items: flex-start; gap: 8px; }
    .plan-features li:last-child { border-bottom: none; }
    .plan-features li .fi { font-size: 12px; margin-top: 2px; flex-shrink: 0; color: var(--green); }
    .plan-features li.muted .fi { color: var(--text-faint); }
    .plan-features li.muted { color: var(--text-faint); }
    .plan-cta { width: 100%; padding: 11px; border-radius: 8px; font-size: 14px; font-weight: 500; font-family: 'DM Sans', sans-serif; cursor: pointer; transition: all 0.15s; }
    .plan-cta.outline { background: none; border: 1px solid var(--border2); color: var(--text-muted); }
    .plan-cta.outline:hover { border-color: var(--blue); color: var(--blue); }
    .plan-cta.filled { background: var(--blue); border: none; color: #fff; box-shadow: 0 0 20px var(--blue-glow); }
    .plan-cta.filled:hover { opacity: 0.85; }
    .pricing-note { text-align: center; margin-top: 14px; font-size: 12px; color: var(--text-faint); }

    /* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
    .modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); z-index: 200; display: none; align-items: center; justify-content: center; padding: 20px; }
    .modal-bg.open { display: flex; }
    .modal { background: var(--surface2); border: 1px solid var(--border2); border-radius: 16px; padding: 32px; width: 100%; max-width: 380px; box-shadow: 0 32px 80px rgba(0,0,0,0.5); position: relative; animation: mIn 0.2s ease; }
    @keyframes mIn { from{opacity:0;transform:scale(0.95)} to{opacity:1;transform:none} }
    .modal-x { position: absolute; top: 14px; right: 14px; background: none; border: none; color: var(--text-faint); font-size: 18px; cursor: pointer; width: 30px; height: 30px; border-radius: 6px; display: flex; align-items: center; justify-content: center; }
    .modal-x:hover { background: var(--surface); color: var(--text); }
    .modal-title { font-size: 20px; font-weight: 600; letter-spacing: -0.4px; margin-bottom: 4px; }
    .modal-sub { font-size: 13px; color: var(--text-muted); margin-bottom: 24px; }
    .modal-msg { font-size: 13px; padding: 10px 14px; border-radius: 8px; margin-bottom: 12px; display: none; font-weight: 500; }
    .modal-msg.visible { display: block; }
    .modal-msg.error   { background: var(--red-bg); color: var(--red); border: 1px solid var(--red-border); }
    .modal-msg.success { background: var(--green-bg); color: var(--green); border: 1px solid var(--green-border); }
    .modal-input { width: 100%; background: var(--bg2); border: 1.5px solid var(--border); color: var(--text); padding: 11px 14px; font-size: 14px; font-family: 'DM Sans', sans-serif; border-radius: 8px; outline: none; margin-bottom: 10px; display: block; transition: border-color 0.15s; }
    .modal-input:focus { border-color: var(--blue); }
    .modal-submit { width: 100%; background: var(--blue); border: none; color: #fff; padding: 12px; font-size: 14px; font-weight: 500; font-family: 'DM Sans', sans-serif; border-radius: 8px; cursor: pointer; margin-bottom: 12px; transition: opacity 0.15s; box-shadow: 0 0 20px var(--blue-glow); }
    .modal-submit:hover { opacity: 0.85; }
    .modal-submit:disabled { opacity: 0.35; cursor: not-allowed; box-shadow: none; }
    .modal-switch { text-align: center; font-size: 13px; color: var(--text-muted); }
    .modal-switch a { color: var(--blue); font-weight: 500; cursor: pointer; text-decoration: underline; text-underline-offset: 3px; }
    .pass-wrap { position: relative; }
    .pass-wrap .modal-input { padding-right: 44px; width: 100%; }
    .pass-eye { position: absolute; right: 13px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: var(--text-faint); font-size: 16px; padding: 0; line-height: 1; }

    /* ‚îÄ‚îÄ User Dropdown ‚îÄ‚îÄ */
    .user-menu { position: relative; display: inline-flex; align-items: center; gap: 8px; }
    .user-btn { background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 6px 12px; font-size: 12px; font-family: 'DM Mono', monospace; color: var(--text-muted); cursor: pointer; display: flex; align-items: center; gap: 6px; transition: border-color 0.15s; max-width: 180px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .user-btn:hover { border-color: var(--blue); color: var(--text); }
    .user-btn::after { content: "‚ñæ"; font-size: 10px; flex-shrink: 0; }
    .user-dropdown { position: absolute; top: calc(100% + 8px); right: 0; background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; padding: 6px; min-width: 180px; z-index: 100; box-shadow: 0 8px 32px rgba(0,0,0,0.4); display: none; }
    .user-dropdown.open { display: block; }
    .user-dropdown-item { display: flex; align-items: center; gap: 8px; padding: 8px 10px; border-radius: 6px; font-size: 13px; color: var(--text-muted); cursor: pointer; transition: background 0.1s; white-space: nowrap; }
    .user-dropdown-item:hover { background: var(--surface3); color: var(--text); }
    .user-dropdown-item.danger { color: #ef4444; }
    .user-dropdown-item.danger:hover { background: rgba(239,68,68,0.08); }
    .user-dropdown-sep { height: 1px; background: var(--border); margin: 4px 0; }

    /* ‚îÄ‚îÄ History Modal ‚îÄ‚îÄ */
    .history-modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); z-index: 300; display: none; align-items: center; justify-content: center; padding: 20px; }
    .history-modal-bg.open { display: flex; }
    .history-modal { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 28px; width: 100%; max-width: 560px; max-height: 80vh; overflow-y: auto; }
    .history-modal-title { font-size: 18px; font-weight: 600; letter-spacing: -0.4px; margin-bottom: 4px; }
    .history-modal-sub { font-size: 13px; color: var(--text-muted); margin-bottom: 20px; }
    .history-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 8px; gap: 12px; }
    .history-domain { font-family: 'DM Mono', monospace; font-size: 13px; color: var(--text); flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .history-score { font-size: 13px; font-weight: 600; font-family: 'DM Mono', monospace; }
    .history-verdict { font-size: 11px; padding: 2px 8px; border-radius: 4px; font-weight: 600; letter-spacing: 0.3px; }
    .history-verdict.GREEN { background: var(--green-bg); color: var(--green); border: 1px solid var(--green-border); }
    .history-verdict.YELLOW { background: var(--yellow-bg); color: var(--yellow); border: 1px solid var(--yellow-border); }
    .history-verdict.RED { background: var(--red-bg); color: var(--red); border: 1px solid var(--red-border); }
    .history-date { font-size: 11px; color: var(--text-faint); font-family: 'DM Mono', monospace; white-space: nowrap; }
    .history-empty { text-align: center; color: var(--text-faint); font-size: 14px; padding: 32px 0; }

    /* ‚îÄ‚îÄ Change Password Modal ‚îÄ‚îÄ */
    .chpass-modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); z-index: 300; display: none; align-items: center; justify-content: center; padding: 20px; }
    .chpass-modal-bg.open { display: flex; }
    .pass-eye:hover { color: var(--text-muted); }
  </style>
</head>
<body>
<div class="page">

  <!-- Anon Limit Modal -->
  <div class="modal-bg" id="anonModal">
    <div class="modal">
      <div class="modal-title">Free account required</div>
      <div class="modal-sub" style="margin-bottom:20px;">You've used your free scan. Create a free account to scan any website ‚Äî no credit card needed.</div>
      <button class="modal-submit" onclick="closeAnonModal();openModal('signup')">Create free account</button>
      <div style="text-align:center;font-size:13px;color:var(--text-muted);margin-top:10px;">Already have an account? <a onclick="closeAnonModal();openModal('signin')" style="color:var(--blue);cursor:pointer;text-decoration:underline;text-underline-offset:3px;">Sign in</a></div>
    </div>
  </div>

  <!-- Password Reset Modal -->
  <div class="modal-bg" id="resetModal">
    <div class="modal">
      <div class="modal-title">Set new password</div>
      <div class="modal-sub">Enter your new password below.</div>
      <div class="modal-msg" id="resetMsg"></div>
      <div class="pass-wrap">
        <input class="modal-input" type="password" id="resetPass" placeholder="New password (min 6 characters)" />
        <button class="pass-eye" type="button" onclick="togglePass('resetPass',this)" tabindex="-1">üëÅ</button>
      </div>
      <div class="pass-wrap">
        <input class="modal-input" type="password" id="resetPass2" placeholder="Confirm new password" onkeydown="if(event.key==='Enter')doReset()" />
        <button class="pass-eye" type="button" onclick="togglePass('resetPass2',this)" tabindex="-1">üëÅ</button>
      </div>
      <button class="modal-submit" id="resetBtn" onclick="doReset()">Update password</button>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-bg" id="authModal">
    <div class="modal">
      <button class="modal-x" onclick="closeModal()">‚úï</button>
      <div class="modal-title" id="mTitle">Sign in</div>
      <div class="modal-sub" id="mSub">Welcome back to Signum</div>
      <div class="modal-msg" id="mMsg"></div>
      <input class="modal-input" type="email" id="mEmail" placeholder="Email address" autocomplete="email" />
      <div class="pass-wrap">
        <input class="modal-input" type="password" id="mPass" placeholder="Password" onkeydown="if(event.key==='Enter')doAuth()" />
        <button class="pass-eye" type="button" onclick="togglePass('mPass',this)" tabindex="-1">üëÅ</button>
      </div>
      <div class="pass-wrap" id="mConfirmWrap" style="display:none;">
        <input class="modal-input" type="password" id="mConfirm" placeholder="Confirm password" onkeydown="if(event.key==='Enter')doAuth()" />
        <button class="pass-eye" type="button" onclick="togglePass('mConfirm',this)" tabindex="-1">üëÅ</button>
      </div>
      <button class="modal-submit" id="mBtn" onclick="doAuth()">Sign in</button>
      <div class="modal-switch" id="mSwitch">Don't have an account? <a onclick="toggleMode()">Sign up free</a></div>
      <div style="text-align:center;margin-top:8px;" id="mForgotWrap">
        <a onclick="toggleMode('forgot')" style="font-size:12px;color:var(--text-faint);cursor:pointer;text-decoration:underline;text-underline-offset:3px;">Forgot password?</a>
      </div>
    </div>
  </div>

  <!-- Scan History Modal -->
  <div class="history-modal-bg" id="historyModal" onclick="if(event.target===this)closeHistory()">
    <div class="history-modal">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;">
        <div class="history-modal-title">Scan History</div>
        <button onclick="closeHistory()" style="background:none;border:none;cursor:pointer;color:var(--text-faint);font-size:18px;">‚úï</button>
      </div>
      <div class="history-modal-sub" id="historySubtitle">Your recent domain scans</div>
      <div id="historyList"><div class="history-empty">Loading...</div></div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div class="chpass-modal-bg" id="chpassModal" onclick="if(event.target===this)closeChpass()">
    <div class="modal">
      <button class="modal-x" onclick="closeChpass()">‚úï</button>
      <div class="modal-title">Change password</div>
      <div class="modal-sub">Enter your new password below.</div>
      <div class="modal-msg" id="chpassMsg"></div>
      <div class="pass-wrap">
        <input class="modal-input" type="password" id="chpassNew" placeholder="New password (min 6 characters)" />
        <button class="pass-eye" type="button" onclick="togglePass('chpassNew',this)" tabindex="-1">üëÅ</button>
      </div>
      <div class="pass-wrap">
        <input class="modal-input" type="password" id="chpassConfirm" placeholder="Confirm new password" onkeydown="if(event.key==='Enter')doChangePass()" />
        <button class="pass-eye" type="button" onclick="togglePass('chpassConfirm',this)" tabindex="-1">üëÅ</button>
      </div>
      <button class="modal-submit" id="chpassBtn" onclick="doChangePass()">Update password</button>
    </div>
  </div>

  <!-- Nav -->
  <nav>
    <a class="logo" href="#">
      <div class="logo-icon">
        <svg viewBox="0 0 15 15"><polyline points="2,11 5,7 8,9 13,3"/></svg>
      </div>
      Signum
    </a>
    <div class="nav-right">
      <div id="navAuth">
        <button class="btn-sm btn-blue" onclick="openModal()">Sign in</button>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <div class="hero">
    <div class="hero-badge">
      <span class="badge-dot"></span>
      <span id="tBadge">20 intelligence sources ¬∑ Live analysis</span>
    </div>
    <h1 class="hero-title" id="tHeroTitle">The intelligence layer<br/>between you and <em>the internet.</em></h1>
    <p class="hero-sub" id="tHeroSub">Real-time risk analysis on any website ‚Äî instant, accurate, uncompromising.</p>
  </div>

  <!-- Plan banners -->
  <div class="plan-banner free" id="freeBanner" style="display:none!important;">
  </div>
  <div class="plan-banner pro" id="proBanner">
    <div>
      <div class="banner-label" id="tProPlanLabel">Pro plan</div>
      <div class="banner-sub" id="tProPlanSub">Unlimited scans</div>
    </div>
  </div>

  <div class="msg success" id="successMsg"></div>

  <!-- Search -->
  <div class="search-wrap">
    <div class="search-box">
      <input class="search-input" type="text" id="urlInput" onkeydown="if(event.key==='Enter')runScan()" />
      <button class="search-btn" id="scanBtn" onclick="runScan()">Analyze</button>
    </div>
    <div class="search-hint" id="tHint">No account required ¬∑ Results in ~20 seconds</div>
  </div>

  <!-- How it works -->
  <div class="how-wrap" id="howSection">
    <div class="how-step">
      <div class="how-num">01</div>
      <div class="how-title" id="tH1">Enter URL</div>
      <div class="how-sub" id="tH1s">Paste any website address into the field above.</div>
    </div>
    <div class="how-step">
      <div class="how-num">02</div>
      <div class="how-title" id="tH2">Scan signals</div>
      <div class="how-sub" id="tH2s">We query 20 global intelligence sources simultaneously.</div>
    </div>
    <div class="how-step">
      <div class="how-num">03</div>
      <div class="how-title" id="tH3">Get report</div>
      <div class="how-sub" id="tH3s">Receive a clear risk score with full explanation.</div>
    </div>
  </div>

  <!-- Status -->
  <div class="status-wrap" id="statusWrap">
    <div class="status-inner">
      <div class="spinner"></div>
      <div class="status-text" id="statusText">Initializing...</div>
    </div>
  </div>
  <div class="msg error" id="errorMsg"></div>

  <!-- Report -->
  <div class="report" id="reportSection">

    <div class="verdict-card" id="verdictCard">
      <div class="verdict-top">
        <div class="score-ring">
          <svg viewBox="0 0 80 80">
            <circle class="score-ring-bg" cx="40" cy="40" r="33"/>
            <circle class="score-ring-fill" id="scoreArc" cx="40" cy="40" r="33" stroke-dasharray="207" stroke-dashoffset="207"/>
          </svg>
          <div class="score-center">
            <div class="score-num" id="scoreNum">0</div>
            <div class="score-lbl">RISK</div>
          </div>
        </div>
        <div class="verdict-meta">
          <div class="verdict-label" id="verdictLabel">‚Äî</div>
          <div class="verdict-summary" id="verdictSummary"></div>
          <button class="share-btn" onclick="shareReport()" id="tShareBtn">‚Üó Share report</button>
        <div id="scanCountWrap" style="margin-top:8px;font-size:12px;color:var(--text-faint);font-family:'DM Mono',monospace;display:none;">
          <span id="scanCountText"></span>
        </div>
        </div>
      </div>

      <!-- Security Dashboard -->
      <div class="dashboard" id="dashboardWrap">
        <div class="confidence-row">
          <span class="confidence-label" id="tConfLabel">CONFIDENCE LEVEL</span>
          <span class="confidence-badge" id="confBadge">‚Äî</span>
        </div>
        <div id="dashSignals"></div>
      </div>
    </div>

    <div class="locked-section" id="findingsLock">
      <div class="section">
        <div class="section-header" id="tFindings">Findings</div>
        <div id="findingsList"></div>
      </div>
      <div class="lock-overlay" id="findingsOverlay" style="display:none;">
        <div class="lock-icon">üîí</div>
        <div class="lock-title">Unlock Full Intelligence Report</div>
        <div class="lock-sub">See exactly why this site is risky ‚Äî or safe.</div>
        <div class="lock-features">
          <div class="lock-feature">Complete AI threat analysis</div>
          <div class="lock-feature">20 intelligence source breakdown</div>
          <div class="lock-feature">Malicious code scanner</div>
          <div class="lock-feature">Scan history &amp; watchlist</div>
        </div>
        <button class="lock-btn" onclick="upgradeToPro()">Upgrade to Pro ‚Äî ‚Ç¨3.99/month</button>
        <div style="font-size:11px;color:var(--text-faint);margin-top:6px;">Cheaper than being scammed ¬∑ Cancel anytime</div>
      </div>
    </div>

    <div class="locked-section" id="analysisLock">
      <div class="section">
        <div class="section-header" id="tAnalysis">AI Analysis</div>
        <div class="narrative" id="narrativeText"></div>
      </div>
      <div class="lock-overlay" id="analysisOverlay" style="display:none;"></div>
    </div>

    <div class="locked-section" id="rawLock">
      <div class="section">
        <button class="raw-btn" onclick="toggleRaw()">
          <span id="rawArrow">‚ñ∏</span> <span id="tRawLabel">Raw intelligence data</span>
        </button>
        <div class="data-grid" id="dataGrid"></div>
      </div>
      <div class="lock-overlay" id="rawOverlay" style="display:none;"></div>
    </div>
  </div>

  <!-- Trust Strip -->
  <div class="trust-strip">
    <div class="trust-item"><span class="trust-icon">üîí</span><span id="tT1">Encrypted scanning</span></div>
    <div class="trust-item"><span class="trust-icon">üõ°</span><span id="tT2">Privacy focused</span></div>
    <div class="trust-item"><span class="trust-icon">‚ö°</span><span id="tT3">Real-time analysis</span></div>
    <div class="trust-item"><span class="trust-icon">üåç</span><span id="tT4">20 global sources</span></div>
  </div>

  <!-- Pricing -->
  <div class="pricing">
    <div class="pricing-head">
      <h2 class="pricing-title">Everything you need to stay safe online</h2>
      <p class="pricing-sub">More than peace of mind.</p>
    </div>
    <div class="pricing-grid">
      <div class="pricing-card">
        <div class="plan-name">Free</div>
        <div class="plan-price">‚Ç¨0</div>
        <div class="plan-period">forever</div>
        <ul class="plan-features">
          <li><span class="fi">‚úì</span>Risk score (0‚Äì100)</li>
          <li><span class="fi">‚úì</span>Safe / Caution / Danger verdict</li>
          <li><span class="fi">‚úì</span>Basic confidence level</li>
          <li class="muted"><span class="fi">‚Äì</span>Full AI threat analysis</li>
          <li class="muted"><span class="fi">‚Äì</span>20 source breakdown</li>
          <li class="muted"><span class="fi">‚Äì</span>Malicious code scanner</li>
          <li class="muted"><span class="fi">‚Äì</span>Scan history</li>
          <li class="muted"><span class="fi">‚Äì</span>Watchlist &amp; alerts</li>
          <li class="muted"><span class="fi">‚Äì</span>Priority support</li>
        </ul>
        <button class="plan-cta outline" onclick="openModal()">Get started free</button>
      </div>
      <div class="pricing-card pro">
        <div class="popular-badge">MOST POPULAR</div>
        <div class="plan-name">Pro</div>
        <div class="plan-price">‚Ç¨3.99</div>
        <div class="plan-period">per month</div>
        <div style="font-size:12px;color:var(--text-muted);margin-bottom:16px;padding:8px 12px;background:rgba(34,197,94,0.08);border:1px solid rgba(34,197,94,0.2);border-radius:6px;">
          üõ° Cheaper than being scammed
        </div>
        <ul class="plan-features">
          <li><span class="fi">‚úì</span>Everything in Free</li>
          <li><span class="fi">‚úì</span>Full AI threat analysis</li>
          <li><span class="fi">‚úì</span>20 intelligence source breakdown</li>
          <li><span class="fi">‚úì</span>Malicious code scanner</li>
          <li><span class="fi">‚úì</span>SSL &amp; infrastructure deep dive</li>
          <li><span class="fi">‚úì</span>Business registry checks</li>
          <li><span class="fi">‚úì</span>Scan history &amp; dashboard</li>
          <li><span class="fi">‚úì</span>Watchlist with real-time alerts</li>
          <li><span class="fi">‚úì</span>Weekly threat digest email</li>
          <li><span class="fi">‚úì</span>Priority support</li>
        </ul>
        <button class="plan-cta filled" onclick="upgradeToPro()">Upgrade to Pro ‚Äî ‚Ç¨3.99/month</button>
      </div>
    </div>
    <div class="pricing-note">Cancel anytime ¬∑ Billed monthly ¬∑ No hidden fees</div>
  </div>

  <!-- Footer -->
  <footer style="margin-top:64px;padding:24px 0 32px;border-top:1px solid var(--border);text-align:center;">
    <div style="display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:12px;">
      <div style="width:20px;height:20px;background:var(--blue);border-radius:5px;display:flex;align-items:center;justify-content:center;box-shadow:0 0 10px rgba(59,130,246,0.4);">
        <svg viewBox="0 0 15 15" width="10" height="10" style="stroke:#fff;fill:none;stroke-width:2.2;stroke-linecap:round;stroke-linejoin:round;"><polyline points="2,11 5,7 8,9 13,3"/></svg>
      </div>
      <span style="font-size:14px;font-weight:600;color:var(--text-muted);">Signum</span>
    </div>
    <div style="font-size:12px;color:var(--text-faint);margin-bottom:10px;">Building the global trust infrastructure of the internet.</div>
    <div style="display:flex;align-items:center;justify-content:center;gap:16px;flex-wrap:wrap;">
      <a href="/cdn-cgi/l/email-protection#81f2f4f1f1eef3f5c1f2e8e6eff4ece0e8e0f1f1afe2eeec" style="font-size:12px;color:var(--text-faint);text-decoration:none;">Contact</a>
      <span style="color:var(--border2);">¬∑</span>
      <a href="#" style="font-size:12px;color:var(--text-faint);text-decoration:none;">Privacy Policy</a>
      <span style="color:var(--border2);">¬∑</span>
      <a href="#" style="font-size:12px;color:var(--text-faint);text-decoration:none;">Terms of Service</a>
      <span style="color:var(--border2);">¬∑</span>
      <span style="font-size:12px;color:var(--text-faint);">¬© 2025 Signum. All rights reserved.</span>
    </div>
  </footer>

</div>

  <!-- Share Modal -->
  <div class="share-modal" id="shareModal" onclick="if(event.target===this)closeShare()">
    <div class="share-sheet">
      <div class="share-sheet-title" id="tShareTitle">Share security report</div>
      <div class="share-sheet-sub" id="tShareSub">‚Äî</div>
      <div class="share-platforms">
        <a class="share-platform" id="shareWhatsApp" href="#" target="_blank" rel="noopener">
          <span class="share-platform-icon">üí¨</span>
          <span class="share-platform-name">WhatsApp</span>
        </a>
        <a class="share-platform" id="shareViber" href="#" target="_blank" rel="noopener">
          <span class="share-platform-icon">üì±</span>
          <span class="share-platform-name">Viber</span>
        </a>
        <a class="share-platform" id="shareTwitter" href="#" target="_blank" rel="noopener">
          <span class="share-platform-icon">üê¶</span>
          <span class="share-platform-name">X / Twitter</span>
        </a>
        <a class="share-platform" id="shareFacebook" href="#" target="_blank" rel="noopener">
          <span class="share-platform-icon">üë•</span>
          <span class="share-platform-name">Facebook</span>
        </a>
        <a class="share-platform" id="shareLinkedIn" href="#" target="_blank" rel="noopener">
          <span class="share-platform-icon">üíº</span>
          <span class="share-platform-name">LinkedIn</span>
        </a>
        <a class="share-platform" id="shareTelegram" href="#" target="_blank" rel="noopener">
          <span class="share-platform-icon">‚úàÔ∏è</span>
          <span class="share-platform-name">Telegram</span>
        </a>
        <a class="share-platform" id="shareEmail" href="#" target="_blank" rel="noopener">
          <span class="share-platform-icon">üìß</span>
          <span class="share-platform-name">Email</span>
        </a>
        <a class="share-platform" id="shareReddit" href="#" target="_blank" rel="noopener">
          <span class="share-platform-icon">ü§ñ</span>
          <span class="share-platform-name">Reddit</span>
        </a>
      </div>
      <div class="share-copy-row">
        <input class="share-copy-input" id="shareCopyInput" readonly />
        <button class="share-copy-btn" id="shareCopyBtn" onclick="copyShareLink()">Copy</button>
      </div>
      <button class="share-dismiss" onclick="closeShare()" id="tShareDismiss">Dismiss</button>
    </div>
  </div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
var BACKEND = "https://detective-app-production-7080.up.railway.app";
var SB_URL  = "https://harhjuykvkfwksccjjxq.supabase.co";
var SB_KEY  = "sb_publishable_gNTIfFSDai7wWPMPIVM-Vg_2rthrcNV";

var user=null, token=null, plan="free", mode="signin", anonScans=parseInt(localStorage.getItem('sg_anon_scans')||'0');







// ‚îÄ‚îÄ Auth ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function sbRefresh(){
  var rt = localStorage.getItem("sg_refresh");
  if(!rt) return;
  fetch(SB_URL+"/auth/v1/token?grant_type=refresh_token",{
    method:"POST",
    headers:{"Content-Type":"application/json","apikey":SB_KEY},
    body:JSON.stringify({refresh_token:rt})
  }).then(function(r){return r.json();}).then(function(d){
    if(d.access_token){
      token=d.access_token; user=d.user;
      localStorage.setItem("sg_token",token);
      localStorage.setItem("sg_user",JSON.stringify(d.user));
      if(d.refresh_token) localStorage.setItem("sg_refresh",d.refresh_token);
      fetchPlan(d.user.id); updateUI();
    } else {
      // Refresh failed ‚Äî log out silently
      token=null; user=null; plan="free";
      localStorage.removeItem("sg_token"); localStorage.removeItem("sg_user");
      localStorage.removeItem("sg_refresh"); localStorage.removeItem("sg_plan");
      updateUI();
    }
  }).catch(function(){});
}

function sbIn(e,p){ return fetch(SB_URL+"/auth/v1/token?grant_type=password",{method:"POST",headers:{"Content-Type":"application/json","apikey":SB_KEY},body:JSON.stringify({email:e,password:p})}).then(function(r){return r.json();}); }
function sbUp(e,p){ return fetch(SB_URL+"/auth/v1/signup",{method:"POST",headers:{"Content-Type":"application/json","apikey":SB_KEY},body:JSON.stringify({email:e,password:p})}).then(function(r){return r.json();}); }
function sbOut(){
  if(token) fetch(SB_URL+"/auth/v1/logout",{method:"POST",headers:{"Authorization":"Bearer "+token,"apikey":SB_KEY}});
  user=null; token=null; plan="free";
  localStorage.removeItem("sg_token"); localStorage.removeItem("sg_user"); localStorage.removeItem("sg_plan");
  updateUI();
}
function fetchPlan(uid){
  fetch(SB_URL+"/rest/v1/profiles?id=eq."+uid+"&select=plan,subscription_status",{headers:{"apikey":SB_KEY,"Authorization":"Bearer "+token}})
  .then(function(r){return r.json();}).then(function(d){
    if(d&&d[0]){ plan=(d[0].subscription_status==="active")?d[0].plan:"free"; localStorage.setItem("sg_plan",plan); updateUI(); }
  }).catch(function(){});
}

window.addEventListener("load",function(){
  // Handle password reset flow from email link
  var hash = window.location.hash;
  var params = new URLSearchParams(hash.replace('#',''));
  var accessToken = params.get('access_token');
  var resetType = params.get('type');
  if(accessToken && resetType === 'recovery'){
    token = accessToken;
    document.getElementById("resetModal").classList.add("open");
    window.history.replaceState({},"",location.pathname);
  }

  var st=localStorage.getItem("sg_token"), su=localStorage.getItem("sg_user"), sr=localStorage.getItem("sg_refresh");
  if(sr && sr!=="null"){
    // Always try to refresh token on page load for persistent login
    try{ user=JSON.parse(su); token=st; plan=localStorage.getItem("sg_plan")||"free"; updateUI(); } catch(e){}
    sbRefresh();
  } else if(st&&st!=="null"&&su&&su!=="null"){
    try{ token=st; user=JSON.parse(su); plan=localStorage.getItem("sg_plan")||"free"; fetchPlan(user.id); }
    catch(e){ localStorage.clear(); }
  }
  var p=new URLSearchParams(window.location.search);
  if(p.get("upgrade")==="success"){
    plan="pro"; localStorage.setItem("sg_plan","pro");
    showMsg("successMsg","Welcome to Pro! Unlimited scans unlocked.");
    window.history.replaceState({},"",location.pathname);
  }
  updateUI();
});

function updateUI(){
  var navAuth=document.getElementById("navAuth");
  var fb=document.getElementById("freeBanner");
  var pb=document.getElementById("proBanner");
  if(user){
    navAuth.innerHTML=
      '<div class="user-menu" id="userMenuWrap">'+
        '<button class="user-btn" onclick="toggleDropdown()">'+user.email+'</button>'+
        '<div class="user-dropdown" id="userDropdown">'+
          '<div class="user-dropdown-item" onclick="openHistory()">üìã Scan history</div>'+
          '<div class="user-dropdown-item" onclick="openChpass()">üîë Change password</div>'+
          (plan!=="pro"?'<div class="user-dropdown-item" onclick="upgradeToPro();closeDropdown()">‚≠ê Upgrade to Pro</div>':'')+
          '<div class="user-dropdown-sep"></div>'+
          '<div class="user-dropdown-item danger" onclick="sbOut()">Sign out</div>'+
        '</div>'+
      '</div>';
    fb.style.display=plan==="pro"?"none":"none";
    pb.style.display=plan==="pro"?"flex":"none";
  } else {
    navAuth.innerHTML='<button class="btn-sm btn-blue" onclick="openModal()">'+"Sign in"+'</button>';
    fb.style.display="none"; pb.style.display="none";
  }
}

function toggleDropdown(){
  var d=document.getElementById("userDropdown");
  if(d) d.classList.toggle("open");
}
function closeDropdown(){
  var d=document.getElementById("userDropdown");
  if(d) d.classList.remove("open");
}
document.addEventListener("click",function(e){
  var wrap=document.getElementById("userMenuWrap");
  if(wrap&&!wrap.contains(e.target)) closeDropdown();
});

function openHistory(){
  closeDropdown();
  document.getElementById("historyModal").classList.add("open");
  loadHistory();
}
function closeHistory(){
  document.getElementById("historyModal").classList.remove("open");
}

function loadHistory(){
  var list=document.getElementById("historyList");
  var sub=document.getElementById("historySubtitle");
  if(!token){ list.innerHTML='<div class="history-empty">Sign in to see your scan history.</div>'; return; }
  list.innerHTML='<div class="history-empty">Loading...</div>';
  fetch(SB_URL+"/rest/v1/scan_history?user_id=eq."+user.id+"&order=created_at.desc&limit=50",{
    headers:{"apikey":SB_KEY,"Authorization":"Bearer "+token}
  }).then(function(r){return r.json();}).then(function(data){
    if(!data||!data.length){
      list.innerHTML='<div class="history-empty">No scans yet. Start by checking a website above.</div>';
      sub.textContent="Your recent domain scans";
      return;
    }
    sub.textContent="Showing "+data.length+" recent scan"+(data.length!==1?"s":"");
    list.innerHTML=data.map(function(s){
      var d=new Date(s.created_at);
      var dateStr=d.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"});
      var scoreColor=s.verdict==="GREEN"?"var(--green)":s.verdict==="RED"?"var(--red)":"var(--yellow)";
      return '<div class="history-item">'+
        '<div class="history-domain">'+s.domain+'</div>'+
        '<div class="history-score" style="color:'+scoreColor+'">'+s.score+'</div>'+
        '<div class="history-verdict '+s.verdict+'">'+s.verdict+'</div>'+
        '<div class="history-date">'+dateStr+'</div>'+
      '</div>';
    }).join("");
  }).catch(function(){
    list.innerHTML='<div class="history-empty">Could not load history. Please try again.</div>';
  });
}

function openChpass(){
  closeDropdown();
  document.getElementById("chpassModal").classList.add("open");
  document.getElementById("chpassNew").focus();
}
function closeChpass(){
  document.getElementById("chpassModal").classList.remove("open");
  document.getElementById("chpassMsg").className="modal-msg";
  document.getElementById("chpassNew").value="";
  document.getElementById("chpassConfirm").value="";
}
function doChangePass(){
  var p1=document.getElementById("chpassNew").value;
  var p2=document.getElementById("chpassConfirm").value;
  var btn=document.getElementById("chpassBtn");
  var msg=document.getElementById("chpassMsg");
  if(!p1||p1.length<6){msg.textContent="Password must be at least 6 characters.";msg.className="modal-msg error visible";return;}
  if(p1!==p2){msg.textContent="Passwords do not match.";msg.className="modal-msg error visible";return;}
  btn.disabled=true;btn.textContent="Updating...";
  fetch(SB_URL+"/auth/v1/user",{
    method:"PUT",
    headers:{"Content-Type":"application/json","apikey":SB_KEY,"Authorization":"Bearer "+token},
    body:JSON.stringify({password:p1})
  }).then(function(r){return r.json();}).then(function(d){
    btn.disabled=false;btn.textContent="Update password";
    if(d.error||d.error_description){msg.textContent=d.error_description||d.error;msg.className="modal-msg error visible";}
    else{msg.textContent="Password updated successfully!";msg.className="modal-msg success visible";setTimeout(closeChpass,2000);}
  }).catch(function(){btn.disabled=false;btn.textContent="Update password";msg.textContent="Something went wrong.";msg.className="modal-msg error visible";});
}

function openModal(m){ if(m) mode=m; document.getElementById("authModal").classList.add("open"); setModalMode(mode); document.getElementById("mEmail").focus(); }
function closeModal(){ document.getElementById("authModal").classList.remove("open"); }
function togglePass(id, btn){
  var inp = document.getElementById(id);
  if(inp.type === "password"){ inp.type = "text"; btn.textContent = "üôà"; }
  else { inp.type = "password"; btn.textContent = "üëÅ"; }
}
function closeAnonModal(){ document.getElementById("anonModal").classList.remove("open"); }
function setModalMode(m){
  mode=m;
  var fw=document.getElementById("mForgotWrap");
  var pb=document.getElementById("mPass");
  if(m==="signin"){
    document.getElementById("mTitle").textContent="Sign in";
    document.getElementById("mSub").textContent="Welcome back to Signum";
    document.getElementById("mBtn").textContent="Sign in";
    document.getElementById("mSwitch").innerHTML='Don\'t have an account? <a onclick="toggleMode()">Sign up free</a>';
    if(fw) fw.style.display="block";
    if(pb) pb.style.display="block";
    var cw=document.getElementById("mConfirmWrap"); if(cw) cw.style.display="none"; if(cw) cw.querySelector("input").value="";
  } else if(m==="signup"){
    document.getElementById("mTitle").textContent="Create account";
    document.getElementById("mSub").textContent="Free forever ¬∑ No credit card needed";
    document.getElementById("mBtn").textContent="Create account";
    document.getElementById("mSwitch").innerHTML='Already have an account? <a onclick="toggleMode()">Sign in</a>';
    if(fw) fw.style.display="none";
    if(pb) pb.style.display="block";
    var cw=document.getElementById("mConfirmWrap"); if(cw) cw.style.display="block";
  } else if(m==="forgot"){
    document.getElementById("mTitle").textContent="Reset password";
    document.getElementById("mSub").textContent="We'll send a reset link to your email";
    document.getElementById("mBtn").textContent="Send reset link";
    document.getElementById("mSwitch").innerHTML='Remembered it? <a onclick="toggleMode(\'signin\')">Sign in</a>';
    if(fw) fw.style.display="none";
    if(pb) pb.style.display="none";
  }
  document.getElementById("mMsg").className="modal-msg";
}
function toggleMode(m){ setModalMode(m||(mode==="signin"?"signup":"signin")); }

function doAuth(){
  var e=document.getElementById("mEmail").value.trim();
  var btn=document.getElementById("mBtn");
  if(!e){ showModalMsg("Please enter your email.","error"); return; }

  if(mode==="forgot"){
    btn.disabled=true; btn.textContent="Sending...";
    fetch("https://detective-app-production-7080.up.railway.app/send-reset",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({email:e})
    }).then(function(r){ return r.json(); }).then(function(d){
      btn.disabled=false; btn.textContent="Send reset link";
      if(d.ok){ showModalMsg("Reset link sent! Check your inbox.","success"); }
      else { showModalMsg("Could not send reset email. Try again.","error"); }
    }).catch(function(){
      btn.disabled=false; btn.textContent="Send reset link";
      showModalMsg("Could not send reset email. Try again.","error");
    });
    return;
  }

  var p=document.getElementById("mPass").value;
  if(!p){ showModalMsg("Please enter your password.","error"); return; }
  if(mode==="signup"){
    var p2=document.getElementById("mConfirm").value;
    if(!p2){ showModalMsg("Please confirm your password.","error"); return; }
    if(p!==p2){ showModalMsg("Passwords do not match.","error"); return; }
    if(p.length<6){ showModalMsg("Password must be at least 6 characters.","error"); return; }
  }
  btn.disabled=true; btn.textContent="...";
  var pr=mode==="signin"?sbIn(e,p):sbUp(e,p);
  pr.then(function(d){
    btn.disabled=false; btn.textContent=mode==="signin"?"Sign in":"Create account";
    if(d.error||d.error_description){ showModalMsg(d.error_description||d.error,"error"); return; }
    if(mode==="signup"&&!d.access_token){ showModalMsg("Account created! You can now sign in.","success"); setTimeout(function(){ toggleMode("signin"); },1500); return; }
    token=d.access_token; user=d.user;
    localStorage.setItem("sg_token",token);
    localStorage.setItem("sg_user",JSON.stringify(user));
    if(d.refresh_token) localStorage.setItem("sg_refresh",d.refresh_token);
    // Reset anon scan counter on login
    anonScans=0; localStorage.setItem("sg_anon_scans","0");
    fetchPlan(user.id); updateUI(); closeModal();
  }).catch(function(){ btn.disabled=false; btn.textContent=mode==="signin"?"Sign in":"Create account"; showModalMsg("Invalid email or password. Please try again.","error"); });
}
function showModalMsg(t,type){ var el=document.getElementById("mMsg"); el.textContent=t; el.className="modal-msg "+type+" visible"; }

// ‚îÄ‚îÄ Upgrade ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function upgradeToPro(){
  if(!user||!token||token==="null"){ openModal(); return; }
  var btn=document.getElementById("upgBtn");
  if(btn){ btn.textContent="..."; btn.disabled=true; }
  fetch(BACKEND+"/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_token:token,user_email:user.email})})
  .then(function(r){return r.json();}).then(function(d){
    if(d.checkout_url){ window.location.href=d.checkout_url; }
    else{ alert("Could not start checkout."); if(btn){btn.textContent="Upgrade to Pro";btn.disabled=false;} }
  }).catch(function(){ alert("Could not start checkout."); if(btn){btn.textContent="Upgrade to Pro";btn.disabled=false;} });
}

// ‚îÄ‚îÄ Scan ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function runScan(){
  var url=document.getElementById("urlInput").value.trim();
  if(!url) return;

  // Enforce anon limit ‚Äî 1 free scan without account
  if(!user){
    if(anonScans >= 1){
      document.getElementById("anonModal").classList.add("open");
      return;
    }
    anonScans++;
    localStorage.setItem("sg_anon_scans", anonScans);
  }
  document.getElementById("reportSection").classList.remove("visible");
  document.getElementById("errorMsg").classList.remove("visible");
  document.getElementById("howSection").style.display="none";
  var sw=document.getElementById("statusWrap"), st=document.getElementById("statusText");
  sw.classList.add("visible");
  var steps=["Initializing scan...","Querying domain registry...","Running malware scan...","Checking Safe Browsing...","Verifying SSL certificate...","Searching global registries...","Scanning community signals...","Checking sanctions lists...","Running live page analysis...","Consulting AI analyst...","Compiling report..."], i=0;
  var iv=setInterval(function(){ if(i<steps.length) st.textContent=steps[i++]; },1300);
  document.getElementById("scanBtn").disabled=true;
  var body={target:url};
  if(token&&token!=="null") body.user_token=token;
  fetch(BACKEND+"/investigate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)})
  .then(function(res){
    clearInterval(iv); document.getElementById("scanBtn").disabled=false; sw.classList.remove("visible");
    if(res.status===429){ showMsg("errorMsg","Daily limit reached ‚Äî upgrade to Pro for unlimited scans."); return null; }
    return res.json().then(function(d){ if(!res.ok){ showMsg("errorMsg",d.detail||"Could not reach server. Please try again."); return null; } return d; });
  }).then(function(d){ if(d) renderReport(d); })
  .catch(function(){ clearInterval(iv); document.getElementById("scanBtn").disabled=false; sw.classList.remove("visible"); showMsg("errorMsg","Could not reach server. Please try again."); });
}

// ‚îÄ‚îÄ Render ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderReport(r){
  var card=document.getElementById("verdictCard");
  card.className="verdict-card "+r.verdict;
  var circ=207;
  var arc=document.getElementById("scoreArc");
  arc.style.strokeDashoffset=circ;
  setTimeout(function(){ arc.style.strokeDashoffset=circ-(r.score/100)*circ; },60);
  document.getElementById("scoreNum").textContent=r.score;
  var verdictLabels={"GREEN":"Safe","YELLOW":"Caution","RED":"Danger"};
  document.getElementById("verdictLabel").textContent=verdictLabels[r.verdict]||r.verdict;
  document.getElementById("verdictSummary").textContent=r.verdict_summary;

  // Confidence level ‚Äî from backend data_confidence field
  var confMap = {"high":"high","medium":"med","low":"low"};
  var conf = confMap[r.data_confidence] || "med";
  var confLabels = {"high":"High Confidence","med":"Medium Confidence","low":"Low Confidence"};
  var confEl = document.getElementById("confBadge");
  confEl.textContent = confLabels[conf];
  confEl.className = "confidence-badge conf-"+conf;

  // Dashboard signals ‚Äî top 5 findings as clean signals
  var signals=document.getElementById("dashSignals");
  signals.innerHTML="";
  (r.findings||[]).slice(0,5).forEach(function(f){
    var icon = f.tag==="OK" ? "‚úî" : f.tag==="RISK" ? "‚úñ" : "‚ö†";
    var color = f.tag==="OK" ? "var(--green)" : f.tag==="RISK" ? "var(--red)" : "var(--yellow)";
    signals.innerHTML+='<div class="dashboard-row"><span class="dash-icon" style="color:'+color+'">'+icon+'</span><span>'+f.text+'</span></div>';
  });

  // Findings
  var list=document.getElementById("findingsList");
  list.innerHTML="";
  (r.findings||[]).forEach(function(f){
    var tc=f.tag==="RISK"?"RISK":f.tag==="OK"?"OK":"CAUTION";
    list.innerHTML+='<div class="finding"><div class="f-icon">'+f.icon+'</div><div class="f-body"><div class="f-tag '+tc+'">'+f.tag+'</div><div class="f-text">'+f.text+'</div></div></div>';
  });

  document.getElementById("narrativeText").textContent=r.narrative;

  var grid=document.getElementById("dataGrid");
  grid.innerHTML="";
  Object.entries(r.raw_labels||{}).forEach(function(e){
    grid.innerHTML+='<div class="data-cell"><div class="data-lbl">'+e[0]+'</div><div class="data-val">'+e[1]+'</div></div>';
  });

  // Feature locking for free users
  var isPro = (plan === "pro");
  var lockIds = ["findingsOverlay", "analysisOverlay", "rawOverlay"];
  lockIds.forEach(function(id){
    var el = document.getElementById(id);
    if(el) el.style.display = isPro ? "none" : "flex";
  });
  // Blur locked sections
  var lockSections = document.querySelectorAll(".locked-section .section");
  lockSections.forEach(function(s){
    s.style.filter = isPro ? "none" : "blur(4px)";
    s.style.pointerEvents = isPro ? "auto" : "none";
    s.style.userSelect = isPro ? "auto" : "none";
  });

  // Log to scan history
  if(user && token){
    fetch(SB_URL+"/rest/v1/scan_history",{
      method:"POST",
      headers:{"apikey":SB_KEY,"Authorization":"Bearer "+token,"Content-Type":"application/json","Prefer":"return=minimal"},
      body:JSON.stringify({user_id:user.id,domain:r.target,score:r.score,verdict:r.verdict})
    }).catch(function(){});
  }

  // Scan count social proof
  var scWrap = document.getElementById("scanCountWrap");
  var scText = document.getElementById("scanCountText");
  var scanCount = parseInt(r.scan_count) || 0;
  if(scanCount > 1){
    scText.textContent = "üîç Scanned " + scanCount + " times by Signum users";
    scWrap.style.display = "block";
  } else {
    scWrap.style.display = "none";
  }

  document.getElementById("reportSection").classList.add("visible");
  document.getElementById("reportSection").scrollIntoView({behavior:"smooth"});
}

function toggleRaw(){
  var g=document.getElementById("dataGrid"), a=document.getElementById("rawArrow");
  g.classList.toggle("open"); a.textContent=g.classList.contains("open")?"‚ñæ":"‚ñ∏";
}

function shareReport(){
  var url=document.getElementById("urlInput").value.trim();
  var score=document.getElementById("scoreNum").textContent;
  var verdict=document.getElementById("verdictLabel").textContent;
  var shareText="I checked "+url+" on Signum ‚Äî Risk score: "+score+"/100 ("+verdict+"). Check any website for free:";
  var shareUrl=location.origin;
  var encoded=encodeURIComponent(shareText+" "+shareUrl);
  var encodedUrl=encodeURIComponent(shareUrl);

  document.getElementById("tShareTitle").textContent = "Share security report";
  document.getElementById("tShareSub").textContent = url+" ‚Äî "+score+"/100 "+verdict;
  document.getElementById("tShareDismiss").textContent = "Dismiss";
  document.getElementById("shareCopyBtn").textContent = "Copy";
  document.getElementById("shareCopyInput").value = shareUrl;

  document.getElementById("shareWhatsApp").href = "https://wa.me/?text="+encoded;
  document.getElementById("shareViber").href = "viber://forward?text="+encoded;
  document.getElementById("shareTwitter").href = "https://twitter.com/intent/tweet?text="+encodeURIComponent(shareText)+"&url="+encodedUrl;
  document.getElementById("shareFacebook").href = "https://www.facebook.com/sharer/sharer.php?u="+encodedUrl+"&quote="+encodeURIComponent(shareText);
  document.getElementById("shareLinkedIn").href = "https://www.linkedin.com/sharing/share-offsite/?url="+encodedUrl;
  document.getElementById("shareTelegram").href = "https://t.me/share/url?url="+encodedUrl+"&text="+encodeURIComponent(shareText);
  document.getElementById("shareEmail").href = "mailto:?subject="+encodeURIComponent("Security report: "+url)+"&body="+encoded;
  document.getElementById("shareReddit").href = "https://reddit.com/submit?url="+encodedUrl+"&title="+encodeURIComponent("Security report: "+url+" ‚Äî "+score+"/100 "+verdict);

  document.getElementById("shareModal").classList.add("open");
}

function closeShare(){
  document.getElementById("shareModal").classList.remove("open");
}

function copyShareLink(){
  var input=document.getElementById("shareCopyInput");
  var btn=document.getElementById("shareCopyBtn");
  navigator.clipboard.writeText(input.value).then(function(){
    btn.textContent="Copied!";
    setTimeout(function(){ btn.textContent="Copy"; },2000);
  }).catch(function(){
    input.select(); document.execCommand("copy");
    btn.textContent="Copied!";
    setTimeout(function(){ btn.textContent="Copy"; },2000);
  });
}

function doReset(){
  var p1 = document.getElementById("resetPass").value;
  var p2 = document.getElementById("resetPass2").value;
  var btn = document.getElementById("resetBtn");
  var msg = document.getElementById("resetMsg");

  if(!p1 || p1.length < 6){
    msg.textContent = "Password must be at least 6 characters.";
    msg.className = "modal-msg error visible"; return;
  }
  if(p1 !== p2){
    msg.textContent = "Passwords do not match.";
    msg.className = "modal-msg error visible"; return;
  }

  btn.disabled = true; btn.textContent = "Updating...";

  fetch(SB_URL+"/auth/v1/user",{
    method:"PUT",
    headers:{
      "Content-Type":"application/json",
      "apikey": SB_KEY,
      "Authorization": "Bearer "+token
    },
    body: JSON.stringify({password: p1})
  }).then(function(r){ return r.json(); }).then(function(d){
    btn.disabled = false; btn.textContent = "Update password";
    if(d.error || d.error_description){
      msg.textContent = d.error_description || d.error;
      msg.className = "modal-msg error visible";
    } else {
      msg.textContent = "Password updated! You can now sign in.";
      msg.className = "modal-msg success visible";
      setTimeout(function(){
        document.getElementById("resetModal").classList.remove("open");
        token = null;
        openModal("signin");
      }, 2000);
    }
  }).catch(function(){
    btn.disabled = false; btn.textContent = "Update password";
    msg.textContent = "Something went wrong. Please try again.";
    msg.className = "modal-msg error visible";
  });
}

</script>
<!--Start of Tawk.to Script-->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/699dd6b3c0b0e71c389107cd/1ji88tbld';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->
</body>
</html>
